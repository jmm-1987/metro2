{% extends 'base.html' %}
{% block title %}Inmuebles{% endblock %}
{% block content %}
<h2>Inmuebles</h2>
<a href="/crear_inmueble" class="btn btn-primary mb-3">Crear inmueble</a>
<form method="get" class="mb-3" style="max-width:300px;">
    <label for="estado">Filtrar por estado:</label>
    <select name="estado" id="estado" class="form-select" onchange="this.form.submit()">
        <option value="">Todos</option>
        <option value="en_venta" {% if request.args.get('estado') == 'en_venta' %}selected{% endif %}>En venta</option>
        <option value="vendido" {% if request.args.get('estado') == 'vendido' %}selected{% endif %}>Vendido</option>
        <option value="cancelado" {% if request.args.get('estado') == 'cancelado' %}selected{% endif %}>Cancelado</option>
        <option value="en_alquiler" {% if request.args.get('estado') == 'en_alquiler' %}selected{% endif %}>En alquiler</option>
    </select>
</form>
<div class="card-list">
{% for inmueble in inmuebles %}
  <div class="card">
    <div class="d-flex align-items-center mb-2">
      <a href="/editar_inmueble/{{ inmueble.id }}" class="fw-bold text-decoration-none me-2">{{ inmueble.direccion }}</a>
      <a href="/editar_inmueble/{{ inmueble.id }}" title="Editar inmueble" class="text-warning"><i class="bi bi-pencil-square"></i></a>
    </div>
    <div class="mb-1"><span class="fw-bold">Descripción:</span> {{ inmueble.descripcion }}</div>
    <div class="mb-1"><span class="fw-bold">Estado:</span> {{ inmueble.estado.replace('_', ' ').capitalize() }}</div>
    <div class="mb-1"><span class="fw-bold">Categoría:</span> {{ inmueble.categoria or '-' }}</div>
    <div class="mb-1"><span class="fw-bold">Precio mínimo:</span> {{ inmueble.precio_min if inmueble.precio_min is not none else '-' }}</div>
    <div class="mb-1"><span class="fw-bold">Precio máximo:</span> {{ inmueble.precio_max if inmueble.precio_max is not none else '-' }}</div>
    <div class="mb-1"><span class="fw-bold">Visto por:</span> {% if inmueble.visto_por_clientes %}{{ inmueble.visto_por_clientes|map(attribute='nombre')|join(', ') }}{% else %}-{% endif %}</div>
    <div class="text-end text-muted" style="font-size:0.9em;">ID: {{ inmueble.id }}</div>
  </div>
{% else %}
  <div class="card"><em>No hay inmuebles registrados.</em></div>
{% endfor %}
</div>
{% endblock %} 